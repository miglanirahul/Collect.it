<?phpClass ImageUploadComponent extends Component {		/**	*Funtion to upload images	* Following function is a utility function used to upload images.	* Input parameters :: file name, upload path, file types that can be used.	* Output parameters :: 	**/	function upload($file_id, $folder="", $types="", $maxSize = 10000000,$thumb = false,$desired_width = 150) 	{		if(!$file_id['name']) return array('','result' => 'No file specified');			$file_title = $file_id['name'];		//Get file extension		$ext_arr = split("\.",basename($file_title));		$ext = strtolower($ext_arr[count($ext_arr)-1]);		//Get the last extension		//Not really uniqe - but for all practical reasons, it is		$uniqer = substr(md5(uniqid(rand(),1)),0,5);		$file_name = $uniqer . '_' . $file_title;//Get Unique Name		$all_types = explode(",",strtolower($types));		if($types) 		{			if(in_array($ext,$all_types));				else 			{				$result = "'".$file_id['name']."' is not a valid file."; //Show error if any.				return array('','result' => $result);			}		}		if($file_id['size'] > $maxSize)		{			$result = "'".$file_id['name']."' is has exceed max allowed size."; //Show error if any.			return array('','result' => $result);		}		//Where the file must be uploaded to		if($folder) $folder .= '/';//Add a '/' at the end of the folder		$uploadfile = $folder . $file_name;		$result = '';		//Move the file from the stored location to the new location		if (!move_uploaded_file($file_id['tmp_name'], $uploadfile)) 		{			$result = "Cannot upload the file '".$file_id['name']."'"; //Show error if any.			if(!file_exists($folder)) 			{				$result .= " : Folder don't exist.";			}			elseif(!is_writable($folder)) 			{				$result .= " : Folder not writable.";			}			elseif(!is_writable($uploadfile)) 			{				$result .= " : File not writable.";			}			$file_name = '';        }		else 		{			if(!$file_id['size']) 			{ //Check if the file is made				@unlink($uploadfile);//Delete the Empty file				$file_name = '';				$result = "Empty file found - please use a valid file."; //Show the error message			}			else 			{				chmod($uploadfile,0777);//Make it universally writable.			}		}		if($thumb == true)		{			$this->make_thumb($folder.$file_name,$folder.'thumb/'.$file_name,$desired_width);		}		$responsearray = array('name' => $file_name, 'size' => $file_id['size'], 'type' => $file_id['type'], 'result' => $result);		return $responsearray;	}	/**	*	*Function to create thumbnail	*	*/	function make_thumb($src,$dest,$desired_width)	{		/* read the source image */		$source_image = imagecreatefromjpeg($src);		$width = imagesx($source_image);		$height = imagesy($source_image);		/* find the "desired height" of this thumbnail, relative to the desired width  */		$desired_height = floor($height*($desired_width/$width));		/* create a new, "virtual" image */		$virtual_image = imagecreatetruecolor($desired_width,$desired_height);		/* copy source image at a resized size */		imagecopyresized($virtual_image,$source_image,0,0,0,0,$desired_width,$desired_height,$width,$height);		/* create the physical thumbnail image to its destination */		imagejpeg($virtual_image,$dest);	}}?>